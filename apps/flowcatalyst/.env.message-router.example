# FlowCatalyst — Message Router Only
#
# Standalone message router deployment (no Platform, no Stream Processor).
# Copy to .env and adjust for your environment.

# =============================================================================
# Service Toggles
# =============================================================================
PLATFORM_ENABLED=false
MESSAGE_ROUTER_ENABLED=true
STREAM_PROCESSOR_ENABLED=false

# =============================================================================
# Server
# =============================================================================
ROUTER_PORT=8080
HOST=0.0.0.0
NODE_ENV=production
LOG_LEVEL=info

# =============================================================================
# Queue Broker
# =============================================================================
# EMBEDDED  — in-memory SQLite (dev/single-instance only, no external deps)
# SQS       — AWS SQS (requires ROUTER_CONFIG_URL for config, plus AWS creds)
# NATS      — NATS JetStream
# ACTIVEMQ  — ActiveMQ via STOMP
QUEUE_TYPE=SQS

# -- SQS --
AWS_REGION=eu-west-1
# AWS_ACCESS_KEY_ID=        # or use IAM role / instance profile
# AWS_SECRET_ACCESS_KEY=
# SQS_ENDPOINT=             # LocalStack: http://localhost:4566

# -- Router config endpoint (SQS mode fetches queue/pool config from here) --
ROUTER_CONFIG_URL=https://platform.example.com/api/router/config
# PLATFORM_API_KEY=

# -- NATS (uncomment if QUEUE_TYPE=NATS) --
# NATS_SERVERS=nats://localhost:4222
# NATS_STREAM_NAME=FLOWCATALYST
# NATS_CONSUMER_NAME=flowcatalyst-router

# -- ActiveMQ (uncomment if QUEUE_TYPE=ACTIVEMQ) --
# ACTIVEMQ_HOST=localhost
# ACTIVEMQ_PORT=61613
# ACTIVEMQ_USERNAME=admin
# ACTIVEMQ_PASSWORD=admin

# =============================================================================
# Hot Standby (Redis-based leader election)
# =============================================================================
# Deploy 2+ instances; one acquires a Redis lock and becomes PRIMARY,
# the others wait as STANDBY and take over automatically when the lock expires.
# Disabled by default — single instance needs no Redis.
STANDBY_ENABLED=false
# STANDBY_INSTANCE_ID=                  # Default: HOSTNAME env var or auto-generated
# STANDBY_LOCK_KEY=message-router-primary-lock
# STANDBY_LOCK_TTL_SECONDS=30           # Standby takes over ~30-40s after primary crash
# REDIS_URL=redis://localhost:6379

# =============================================================================
# Traffic Management (ALB integration)
# =============================================================================
# When PRIMARY/STANDBY transitions happen, automatically register/deregister
# from an AWS ALB target group. Only useful with STANDBY_ENABLED=true or
# manual mode switching via /monitoring/become-primary|become-standby.
TRAFFIC_MANAGEMENT_ENABLED=false
# TRAFFIC_STRATEGY_NAME=AWS_ALB_DEREGISTRATION
# ALB_TARGET_GROUP_ARN=arn:aws:elasticloadbalancing:eu-west-1:123456789:targetgroup/...
# ALB_TARGET_ID=i-0abc123def456      # EC2 instance ID or IP
# ALB_TARGET_PORT=8080
# ALB_DEREGISTRATION_DELAY_SECONDS=300

# =============================================================================
# HTTP Mediation (downstream service calls)
# =============================================================================
# MEDIATION_HTTP2=true                 # Default: true in production
# MEDIATION_CONNECT_TIMEOUT_MS=5000
# MEDIATION_REQUEST_TIMEOUT_MS=900000  # 15 min (long-running ops)
# MEDIATION_HEADERS_TIMEOUT_MS=30000
# MEDIATION_RETRIES=3
# MEDIATION_RETRY_DELAY_MS=1000        # Exponential backoff base

# =============================================================================
# Authentication (protect admin/config endpoints)
# =============================================================================
AUTHENTICATION_ENABLED=false
AUTHENTICATION_MODE=NONE
# AUTHENTICATION_MODE=OIDC
# OIDC_ISSUER_URL=https://platform.example.com
# OIDC_CLIENT_ID=message-router
# OIDC_AUDIENCE=message-router

# =============================================================================
# Health Checks
# =============================================================================
# HEALTH_CHECK_ENABLED=true
# HEALTH_CHECK_INTERVAL_MS=60000
# HEALTH_CHECK_TIMEOUT_MS=5000
# HEALTH_CHECK_FAILURE_THRESHOLD=3

# =============================================================================
# Queue Health Monitor
# =============================================================================
# QUEUE_HEALTH_MONITOR_ENABLED=true
# QUEUE_HEALTH_BACKLOG_THRESHOLD=1000
# QUEUE_HEALTH_GROWTH_THRESHOLD=100
# QUEUE_HEALTH_INTERVAL_MS=30000
# QUEUE_HEALTH_GROWTH_PERIODS=3

# =============================================================================
# Notifications (warnings → email / Teams)
# =============================================================================
# NOTIFICATION_ENABLED=false
# NOTIFICATION_BATCH_INTERVAL_MS=300000
# NOTIFICATION_MIN_SEVERITY=WARNING

# -- Email --
# NOTIFICATION_EMAIL_ENABLED=false
# NOTIFICATION_EMAIL_FROM=router@example.com
# NOTIFICATION_EMAIL_TO=ops@example.com
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USERNAME=
# SMTP_PASSWORD=
# SMTP_SECURE=true

# -- Microsoft Teams --
# NOTIFICATION_TEAMS_ENABLED=false
# NOTIFICATION_TEAMS_WEBHOOK_URL=https://outlook.office.com/webhook/...
