# Test Configuration
# Quarkus test server configuration
%test.quarkus.http.port=8081
%test.quarkus.http.test-port=8081

# Use the internal LocalConfigResource endpoint (same server, no external dependency)
%test.quarkus.rest-client.message-router-config.url=http://localhost:8081/api/config

# Disable message router by default in unit tests to avoid QueueManager startup overhead
# Integration tests that need the message router should use a test profile to enable it
%test.message-router.enabled=false

# Use SQS for tests (LocalStack will be available via docker-compose for integration tests)
%test.message-router.queue-type=SQS
%test.message-router.max-pools=2000

# Disable scheduled syncs in unit tests to avoid background activity
%test.message-router.sync-interval=24h

# Short timeouts for tests
%test.quarkus.rest-client.message-router-config.connect-timeout=1000
%test.quarkus.rest-client.message-router-config.read-timeout=2000

# HTTP mediator timeout - 10 seconds for tests (default is 15 minutes for production)
%test.mediator.http.timeout.ms=10000

# SQS test configuration (use LocalStack if available)
%test.quarkus.sqs.endpoint-override=http://localhost:4566
%test.quarkus.sqs.aws.region=eu-west-1
%test.quarkus.sqs.aws.credentials.type=static
%test.quarkus.sqs.aws.credentials.static-provider.access-key-id=test
%test.quarkus.sqs.aws.credentials.static-provider.secret-access-key=test

# Note: SQS timeout configuration is handled in code (SqsQueueConsumer)
# since Quarkus SQS extension doesn't expose per-operation timeout configuration

# Disable schedulers in tests to avoid shutdown race conditions
%test.quarkus.scheduler.enabled=false
%test.queue.health.monitor.enabled=false
%test.notification.enabled=false

# Test logging - quieter
%test.quarkus.log.level=WARN
%test.quarkus.log.category."tech.flowcatalyst".level=INFO
%test.quarkus.log.console.json.enabled=false

# Authentication configuration - disabled for tests
%test.authentication.enabled=false
%test.authentication.mode=NONE

# OIDC - disabled for tests (prevents TenantContextFactory errors)
%test.quarkus.oidc.enabled=false

# Standby configuration - disabled for tests
%test.standby.enabled=false
%test.standby.instance-id=test-instance-1
%test.standby.lock-key=message-router-primary-lock
%test.standby.lock-ttl-seconds=30

# Traffic management configuration - disabled for tests
%test.traffic-management.enabled=false
%test.traffic-management.strategy=noop

# Quarkus Redis configuration for tests
%test.quarkus.redis.hosts=redis://localhost:6379

# Disable default datasource (no database needed - message router is stateless)
%test.quarkus.datasource.jdbc=false
%test.quarkus.datasource.devservices.enabled=false
