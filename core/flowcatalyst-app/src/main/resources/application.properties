# Full Stack Application Configuration
quarkus.application.name=flowcatalyst
quarkus.banner.enabled=false

# =============================================================================
# SPA Fallback (serve index.html for client-side routes)
# =============================================================================
quarkus.http.enable-compression=true

# =============================================================================
# Authentication Configuration
# =============================================================================

# Auth mode: embedded (full IdP) or remote (validation only)
flowcatalyst.auth.mode=${FLOWCATALYST_AUTH_MODE:embedded}

# External base URL for OAuth callbacks (e.g., http://localhost:4200 in dev)
flowcatalyst.auth.external-base-url=${FLOWCATALYST_EXTERNAL_BASE_URL:}
%dev.flowcatalyst.auth.external-base-url=http://localhost:4200

# JWT Configuration
flowcatalyst.auth.jwt.issuer=${FLOWCATALYST_JWT_ISSUER:flowcatalyst}
flowcatalyst.auth.jwt.private-key-path=${FLOWCATALYST_JWT_PRIVATE_KEY_PATH:}
flowcatalyst.auth.jwt.public-key-path=${FLOWCATALYST_JWT_PUBLIC_KEY_PATH:}
flowcatalyst.auth.jwt.access-token-expiry=${FLOWCATALYST_ACCESS_TOKEN_EXPIRY:PT1H}
flowcatalyst.auth.jwt.session-token-expiry=${FLOWCATALYST_SESSION_TOKEN_EXPIRY:PT8H}
flowcatalyst.auth.jwt.refresh-token-expiry=${FLOWCATALYST_REFRESH_TOKEN_EXPIRY:P30D}
flowcatalyst.auth.jwt.authorization-code-expiry=${FLOWCATALYST_AUTH_CODE_EXPIRY:PT10M}

# Session/Cookie Configuration
flowcatalyst.auth.session.secure=${FLOWCATALYST_SESSION_SECURE:true}
flowcatalyst.auth.session.same-site=${FLOWCATALYST_SESSION_SAME_SITE:Lax}
flowcatalyst.auth.session.cookie-name=${FLOWCATALYST_SESSION_COOKIE:fc_session}
%dev.flowcatalyst.auth.session.secure=false

# PKCE Configuration
flowcatalyst.auth.pkce.required=${FLOWCATALYST_PKCE_REQUIRED:true}

# Remote IdP Configuration (when mode=remote)
flowcatalyst.auth.remote.issuer=${FLOWCATALYST_AUTH_REMOTE_ISSUER:}
flowcatalyst.auth.remote.jwks-url=${FLOWCATALYST_AUTH_REMOTE_JWKS_URL:}
flowcatalyst.auth.remote.login-url=${FLOWCATALYST_AUTH_REMOTE_LOGIN_URL:}
flowcatalyst.auth.remote.logout-url=${FLOWCATALYST_AUTH_REMOTE_LOGOUT_URL:}
flowcatalyst.auth.remote.platform-url=${FLOWCATALYST_AUTH_REMOTE_PLATFORM_URL:}
flowcatalyst.auth.remote.jwks-cache-duration=${FLOWCATALYST_AUTH_REMOTE_JWKS_CACHE:PT1H}

# MP JWT (delegates to our issuer)
mp.jwt.verify.issuer=${flowcatalyst.auth.jwt.issuer}

# Disable Quarkus OIDC client (platform has its own embedded OIDC server)
quarkus.oidc.enabled=false

# Logging Configuration - Dev: readable logs (not JSON)
%dev.quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
%dev.quarkus.log.console.json.enabled=false
%dev.quarkus.log.level=INFO
%dev.quarkus.log.category."tech.flowcatalyst".level=DEBUG

# Logging Configuration - Prod: JSON structured logs
%prod.quarkus.log.console.format=json
%prod.quarkus.log.console.json.pretty-print=false
%prod.quarkus.log.level=INFO
%prod.quarkus.log.console.json.additional-field."service.name".value=flowcatalyst
%prod.quarkus.log.console.json.additional-field."service.version".value=${quarkus.application.version:1.0.0-SNAPSHOT}
%prod.quarkus.log.console.json.additional-field."environment".value=${ENVIRONMENT:production}

# Message Router Configuration
message-router.enabled=true
message-router.queue-type=SQS
message-router.sync-interval=5m
message-router.max-pools=2000
message-router.pool-warning-threshold=1000

# Message Router Consumer Configuration
message-router.sqs.max-messages-per-poll=10
message-router.sqs.wait-time-seconds=20
message-router.activemq.receive-timeout-ms=1000
message-router.metrics.poll-interval-seconds=5

# REST Client Configuration
# Full URL including path, e.g., http://localhost:8000/api/config
quarkus.rest-client.message-router-config.url=${MESSAGE_ROUTER_CONFIG_URL:http://localhost:8080/api/config}
quarkus.rest-client.message-router-config.scope=jakarta.inject.Singleton

# SQS Configuration (when using SQS)
quarkus.sqs.endpoint-override=${SQS_ENDPOINT_OVERRIDE:}
quarkus.sqs.aws.region=${AWS_REGION:eu-west-1}
quarkus.sqs.aws.credentials.type=default

# Dev profile - LocalStack local SQS
%dev.quarkus.sqs.endpoint-override=http://localhost:4566
%dev.quarkus.sqs.aws.region=eu-west-1
%dev.quarkus.sqs.aws.credentials.type=static
%dev.quarkus.sqs.aws.credentials.static-provider.access-key-id=test
%dev.quarkus.sqs.aws.credentials.static-provider.secret-access-key=test

# ActiveMQ Configuration (when using ACTIVEMQ)
activemq.broker.url=${ACTIVEMQ_BROKER_URL:tcp://localhost:61616}
activemq.username=${ACTIVEMQ_USERNAME:admin}
activemq.password=${ACTIVEMQ_PASSWORD:admin}

# HTTP Auth - Platform handles authentication via its own filters
# Quarkus HTTP auth is not used (platform has custom OAuth/session handling)

# =============================================================================
# Redis (optional - only needed if stream-processor.checkpoint.redis.enabled=true)
# =============================================================================
quarkus.redis.devservices.enabled=false
quarkus.redis.health.enabled=false
# quarkus.redis.hosts=redis://localhost:6379

# =============================================================================
# Stream Processor Configuration
# =============================================================================

# Enable the stream processor in all-in-one mode
stream-processor.enabled=true
stream-processor.database=flowcatalyst

# Events stream - projects events to events_read
stream-processor.streams.events.enabled=true
stream-processor.streams.events.source-collection=events
stream-processor.streams.events.projection-collection=events_read
stream-processor.streams.events.mapper=events
stream-processor.streams.events.checkpoint-key=events-stream-checkpoint
stream-processor.streams.events.watch-operations=insert
stream-processor.streams.events.concurrency=10
stream-processor.streams.events.batch-max-size=100
stream-processor.streams.events.batch-max-wait-ms=100

# Dispatch Jobs stream - projects dispatch_jobs to dispatch_jobs_read
stream-processor.streams.dispatch-jobs.enabled=true
stream-processor.streams.dispatch-jobs.source-collection=dispatch_jobs
stream-processor.streams.dispatch-jobs.projection-collection=dispatch_jobs_read
stream-processor.streams.dispatch-jobs.mapper=dispatch-jobs
stream-processor.streams.dispatch-jobs.checkpoint-key=dispatch-jobs-stream-checkpoint
stream-processor.streams.dispatch-jobs.watch-operations=insert,update
stream-processor.streams.dispatch-jobs.concurrency=5
stream-processor.streams.dispatch-jobs.batch-max-size=50
stream-processor.streams.dispatch-jobs.batch-max-wait-ms=100

# Hot standby for stream processor (optional)
# Set standby.enabled=true and configure Redis if running multiple instances
# standby.enabled=false
# standby.lock-key=stream-processor-primary-lock
# standby.lock-ttl-seconds=30

# =============================================================================
# Dispatch Configuration
# =============================================================================

# Queue URL for event dispatch (SQS URL or other queue endpoint)
flowcatalyst.dispatch.queue-url=${FLOWCATALYST_DISPATCH_QUEUE_URL:embedded}

# =============================================================================
# Dispatch Scheduler Configuration
# =============================================================================

# Enable/disable the dispatch job scheduler
dispatch-scheduler.enabled=true

# Interval between polling for pending jobs
dispatch-scheduler.poll-interval=5s

# Number of jobs to fetch per poll cycle
dispatch-scheduler.batch-size=20

# Maximum concurrent message groups being dispatched
dispatch-scheduler.max-concurrent-groups=10

# Queue type (SQS, ACTIVEMQ, EMBEDDED)
dispatch-scheduler.queue-type=EMBEDDED

# Path for embedded SQLite queue database
dispatch-scheduler.embedded-db-path=./dispatch-queue.db

# Processing endpoint URL (receives dispatched jobs)
dispatch-scheduler.processing-endpoint=http://localhost:8080/api/dispatch/process

# Default dispatch pool code
dispatch-scheduler.default-dispatch-pool-code=DISPATCH-POOL

# Dev profile - use in-memory embedded queue
%dev.dispatch-scheduler.embedded-db-path=:memory:

# =============================================================================
# Platform Feature Flags
# =============================================================================

# Enable/disable messaging features (Event Types, Subscriptions, Dispatch Pools/Jobs)
flowcatalyst.features.messaging-enabled=${FLOWCATALYST_FEATURES_MESSAGING_ENABLED:true}

# =============================================================================
# Bootstrap Configuration (First Run)
# =============================================================================
# On first startup, if no anchor users exist, create an admin from these env vars.
# The email domain will automatically be registered as an anchor domain.

flowcatalyst.bootstrap.admin.email=${FLOWCATALYST_BOOTSTRAP_ADMIN_EMAIL:}
flowcatalyst.bootstrap.admin.password=${FLOWCATALYST_BOOTSTRAP_ADMIN_PASSWORD:}
flowcatalyst.bootstrap.admin.name=${FLOWCATALYST_BOOTSTRAP_ADMIN_NAME:Bootstrap Admin}



# =============================================================================
# PostgreSQL Configuration (Primary Database)
# =============================================================================

# Production PostgreSQL settings (override via environment variables)
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${POSTGRES_URL:jdbc:postgresql://localhost:5432/flowcatalyst}
quarkus.datasource.username=${POSTGRES_USER:flowcatalyst}
quarkus.datasource.password=${POSTGRES_PASSWORD:flowcatalyst}
quarkus.datasource.jdbc.max-size=20

# Dev profile
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/flowcatalyst
%dev.quarkus.datasource.username=flowcatalyst
%dev.quarkus.datasource.password=flowcatalyst

# =============================================================================
# Migration Configuration
# =============================================================================

# Enable MongoDB to PostgreSQL migration endpoint
# Only enable this temporarily during migration
flowcatalyst.migration.enabled=${FLOWCATALYST_MIGRATION_ENABLED:false}
%dev.flowcatalyst.migration.enabled=true